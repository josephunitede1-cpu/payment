<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PayGateway AI - Graha Asri Residence</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');
        
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: #f1f5f9;
        }

        .glass-nav {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .qris-container {
            perspective: 1000px;
        }

        .qris-card {
            transition: transform 0.6s;
            transform-style: preserve-3d;
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }

        .qris-card:hover {
            transform: translateY(-5px);
        }

        /* Animasi loading untuk AI */
        .typing-dot {
            width: 4px;
            height: 4px;
            background: #2563eb;
            border-radius: 50%;
            animation: typing 1s infinite;
        }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-4px); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const apiKey = ""; // API Key otomatis dari environment

        const App = () => {
            const [toast, setToast] = useState({ show: false, message: '' });
            const [aiGreeting, setAiGreeting] = useState("Selamat datang! Ada yang bisa dibantu?");
            const [isAiLoading, setIsAiLoading] = useState(false);
            const [showAiModal, setShowAiModal] = useState(false);
            const [userQuery, setUserQuery] = useState("");
            const [aiResponse, setAiResponse] = useState("");
            
            // Konfigurasi data sesuai gambar yang diunggah
            const config = {
                appName: "PayGateway AI",
                merchantName: "QRIS ALL PAYMENT, GRAHA ASRI RESIDENCE",
                nmid: "ID1023252923512",
                qrisImage: "qris.jpg", // Pastikan file gambar ini berada di folder yang sama dengan file HTML
                danaNumber: "0812-3456-7890",
                gopayNumber: "0812-3456-7890",
                whatsappLink: "https://wa.me/6281234567890"
            };

            const callGemini = async (prompt, systemPrompt = "", retries = 5) => {
                const delay = (ms) => new Promise(res => setTimeout(res, ms));
                for (let i = 0; i < retries; i++) {
                    try {
                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                contents: [{ parts: [{ text: prompt }] }],
                                systemInstruction: { parts: [{ text: systemPrompt }] }
                            })
                        });
                        const data = await response.json();
                        return data.candidates?.[0]?.content?.parts?.[0]?.text;
                    } catch (error) {
                        if (i === retries - 1) return "Maaf, asisten sedang sibuk.";
                        await delay(Math.pow(2, i) * 1000);
                    }
                }
            };

            useEffect(() => {
                const fetchGreeting = async () => {
                    const msg = await callGemini("Sapaan ramah maks 10 kata untuk pembeli Graha Asri.", "Asisten pembayaran cerdas.");
                    if(msg) setAiGreeting(msg);
                };
                fetchGreeting();
            }, []);

            const handleCopy = (text, type) => {
                const cleanNumber = text.replace(/-/g, '');
                const textArea = document.createElement("textarea");
                textArea.value = cleanNumber;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                setToast({ show: true, message: `${type} berhasil disalin!` });
                setTimeout(() => setToast({ show: false, message: '' }), 2000);
            };

            const handleAskAi = async () => {
                if (!userQuery.trim() || isAiLoading) return;
                setIsAiLoading(true);
                setAiResponse("");
                const res = await callGemini(userQuery, `Merchant: ${config.merchantName}. NMID: ${config.nmid}. Bantu pelanggan dengan sopan.`);
                setAiResponse(res);
                setIsAiLoading(false);
            };

            return (
                <div className="min-h-screen max-w-md mx-auto bg-white shadow-2xl relative flex flex-col">
                    {/* Toast */}
                    {toast.show && (
                        <div className="fixed top-6 left-1/2 -translate-x-1/2 z-[100] animate-in fade-in zoom-in duration-300">
                            <div className="bg-slate-900 text-white px-6 py-3 rounded-2xl flex items-center gap-3 shadow-2xl">
                                <i data-lucide="check-circle" className="w-5 h-5 text-green-400"></i>
                                <span className="text-sm font-bold">{toast.message}</span>
                            </div>
                        </div>
                    )}

                    {/* Navigation */}
                    <nav className="glass-nav sticky top-0 z-40 px-6 py-4 flex justify-between items-center border-b border-slate-100">
                        <div className="flex items-center gap-2">
                            <div className="w-9 h-9 bg-blue-600 rounded-xl flex items-center justify-center text-white shadow-lg shadow-blue-200">
                                <i data-lucide="layout-grid" className="w-5 h-5"></i>
                            </div>
                            <span className="font-extrabold text-slate-900 text-lg tracking-tight italic">{config.appName}</span>
                        </div>
                        <button onClick={() => setShowAiModal(true)} className="relative w-10 h-10 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center border border-blue-100 transition-transform active:scale-90">
                            <i data-lucide="sparkles" className="w-5 h-5"></i>
                            <span className="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full border-2 border-white"></span>
                        </button>
                    </nav>

                    <div className="flex-1 p-6 space-y-8 overflow-y-auto">
                        {/* Header Message */}
                        <div className="space-y-1">
                            <h2 className="text-2xl font-black text-slate-900 leading-tight">Selesaikan Pembayaran Anda</h2>
                            <p className="text-slate-400 text-sm font-medium italic">"{aiGreeting}"</p>
                        </div>

                        {/* QRIS Card - Using uploaded image */}
                        <div className="qris-container">
                            <div className="qris-card bg-white rounded-[2rem] p-4 border border-slate-100">
                                <div className="relative rounded-2xl overflow-hidden border-4 border-slate-50">
                                    <img 
                                        src={config.qrisImage} 
                                        alt="QRIS Graha Asri" 
                                        className="w-full h-auto object-cover"
                                        onError={(e) => {
                                            e.target.onerror = null;
                                            e.target.src = "https://via.placeholder.com/400x600?text=Scan+QRIS+Graha+Asri";
                                        }}
                                    />
                                </div>
                                <div className="mt-4 text-center px-2">
                                    <h3 className="font-bold text-slate-800 text-sm uppercase leading-tight">{config.merchantName}</h3>
                                    <p className="text-[10px] text-slate-400 font-mono mt-1">NMID: {config.nmid}</p>
                                </div>
                            </div>
                        </div>

                        {/* Transfer Options */}
                        <div className="space-y-4">
                            <div className="flex items-center gap-2 px-1">
                                <i data-lucide="credit-card" className="w-4 h-4 text-blue-600"></i>
                                <span className="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em]">Metode Lainnya</span>
                            </div>

                            <div className="grid gap-3">
                                <div className="bg-slate-50 p-4 rounded-2xl border border-slate-100 flex items-center justify-between group active:scale-[0.98] transition-all">
                                    <div className="flex items-center gap-4">
                                        <div className="w-12 h-12 bg-blue-500 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-blue-100">
                                            <i data-lucide="smartphone" className="w-6 h-6"></i>
                                        </div>
                                        <div>
                                            <p className="text-[10px] font-black text-blue-600 uppercase">DANA</p>
                                            <p className="font-bold text-slate-900 text-lg tracking-tight">{config.danaNumber}</p>
                                        </div>
                                    </div>
                                    <button onClick={() => handleCopy(config.danaNumber, 'DANA')} className="w-10 h-10 flex items-center justify-center text-slate-400 hover:text-blue-600 hover:bg-white rounded-xl transition-colors">
                                        <i data-lucide="copy" className="w-5 h-5"></i>
                                    </button>
                                </div>

                                <div className="bg-slate-50 p-4 rounded-2xl border border-slate-100 flex items-center justify-between group active:scale-[0.98] transition-all">
                                    <div className="flex items-center gap-4">
                                        <div className="w-12 h-12 bg-green-500 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-green-100">
                                            <i data-lucide="smartphone" className="w-6 h-6"></i>
                                        </div>
                                        <div>
                                            <p className="text-[10px] font-black text-green-600 uppercase">GOPAY</p>
                                            <p className="font-bold text-slate-900 text-lg tracking-tight">{config.gopayNumber}</p>
                                        </div>
                                    </div>
                                    <button onClick={() => handleCopy(config.gopayNumber, 'GOPAY')} className="w-10 h-10 flex items-center justify-center text-slate-400 hover:text-green-600 hover:bg-white rounded-xl transition-colors">
                                        <i data-lucide="copy" className="w-5 h-5"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* Admin Action */}
                        <a href={config.whatsappLink} target="_blank" className="flex items-center justify-between p-5 bg-slate-900 rounded-[2rem] text-white shadow-xl shadow-slate-200 active:scale-95 transition-all">
                            <div className="flex items-center gap-4">
                                <div className="w-12 h-12 bg-white/10 rounded-2xl flex items-center justify-center">
                                    <i data-lucide="message-circle" className="w-6 h-6"></i>
                                </div>
                                <div>
                                    <p className="font-bold">Konfirmasi Admin</p>
                                    <p className="text-xs text-slate-400 font-medium tracking-wide">Kirim Bukti Pembayaran</p>
                                </div>
                            </div>
                            <div className="w-10 h-10 bg-white/10 rounded-full flex items-center justify-center">
                                <i data-lucide="arrow-up-right" className="w-5 h-5"></i>
                            </div>
                        </a>
                    </div>

                    <footer className="py-6 text-center border-t border-slate-50">
                        <p className="text-[9px] font-black text-slate-300 uppercase tracking-[0.4em]">Payment Integrated AI System</p>
                    </footer>

                    {/* AI Chat Drawer */}
                    {showAiModal && (
                        <div className="fixed inset-0 z-50 flex items-end justify-center bg-slate-900/60 backdrop-blur-sm p-0 sm:p-4">
                            <div className="bg-white w-full max-w-md rounded-t-[2.5rem] sm:rounded-[2.5rem] shadow-2xl flex flex-col max-h-[85vh] animate-in slide-in-from-bottom duration-500">
                                <div className="p-6 border-b border-slate-50 flex justify-between items-center">
                                    <div className="flex items-center gap-3">
                                        <div className="w-10 h-10 bg-blue-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-blue-100">
                                            <i data-lucide="bot" className="w-5 h-5"></i>
                                        </div>
                                        <div>
                                            <h3 className="font-bold text-slate-900">Asisten Graha Asri</h3>
                                            <div className="flex items-center gap-1.5">
                                                <span className="w-2 h-2 bg-green-500 rounded-full"></span>
                                                <span className="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Aktif</span>
                                            </div>
                                        </div>
                                    </div>
                                    <button onClick={() => setShowAiModal(false)} className="w-10 h-10 bg-slate-50 rounded-full flex items-center justify-center text-slate-400 hover:text-slate-600 transition-colors">
                                        <i data-lucide="x" className="w-5 h-5"></i>
                                    </button>
                                </div>
                                <div className="p-6 overflow-y-auto flex-1 space-y-4 bg-slate-50/30">
                                    {aiResponse ? (
                                        <div className="bg-white border border-slate-100 p-5 rounded-3xl shadow-sm text-sm text-slate-700 leading-relaxed animate-in zoom-in duration-300">
                                            {aiResponse}
                                        </div>
                                    ) : (
                                        <div className="h-full flex flex-col items-center justify-center py-12 text-center">
                                            {isAiLoading ? (
                                                <div className="flex gap-1.5">
                                                    <div className="typing-dot"></div>
                                                    <div className="typing-dot"></div>
                                                    <div className="typing-dot"></div>
                                                </div>
                                            ) : (
                                                <div className="space-y-4">
                                                    <div className="w-16 h-16 bg-white rounded-3xl flex items-center justify-center mx-auto shadow-sm text-blue-200">
                                                        <i data-lucide="help-circle" className="w-8 h-8"></i>
                                                    </div>
                                                    <p className="text-xs font-bold text-slate-300 uppercase tracking-widest">Tanyakan sesuatu...</p>
                                                </div>
                                            )}
                                        </div>
                                    )}
                                </div>
                                <div className="p-6 bg-white border-t border-slate-50">
                                    <div className="relative">
                                        <input 
                                            value={userQuery} 
                                            onChange={(e) => setUserQuery(e.target.value)}
                                            onKeyDown={(e) => e.key === 'Enter' && handleAskAi()}
                                            className="w-full pl-6 pr-16 py-5 bg-slate-50 border-none rounded-3xl text-sm font-medium focus:ring-2 focus:ring-blue-500 transition-all outline-none" 
                                            placeholder="Tanya perihal pembayaran..." 
                                        />
                                        <button onClick={handleAskAi} className="absolute right-2 top-2 bottom-2 aspect-square bg-slate-900 text-white rounded-2xl flex items-center justify-center hover:bg-blue-600 transition-colors shadow-lg">
                                            <i data-lucide="send" className="w-5 h-5"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
        // Memastikan ikon lucide terpasang
        setTimeout(() => lucide.createIcons(), 500);
    </script>
</body>
</html>